{
  "tag": "Eng Intel: 2-Metrics",
  "endpoint_count": 1,
  "schema_count": 13,
  "endpoints_summary": [
    {
      "method": "POST",
      "path": "/api/v1/eng-intel/metrics/point-in-time",
      "operation_id": "queryPointInTimeMetrics",
      "summary": "Execute point-in-time engineering metrics queries"
    }
  ],
  "endpoints": [
    {
      "path": "/api/v1/eng-intel/metrics/point-in-time",
      "method": "POST",
      "operation_id": "queryPointInTimeMetrics",
      "summary": "Execute point-in-time engineering metrics queries",
      "details": {
        "description": "Query current metric values with optional period comparisons and flexible grouping. Supports batch queries for multiple metrics efficiently.",
        "operationId": "queryPointInTimeMetrics",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BatchPointInTimeRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointInTimeResponse"
                }
              }
            },
            "description": "Successfully executed metrics query"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointInTimeResponse"
                }
              }
            },
            "description": "Invalid metric names, date range exceeds 6 months, validation errors, or unsupported orderBy attributes"
          },
          "403": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointInTimeResponse"
                }
              }
            },
            "description": "Feature not enabled - contact help@cortex.io"
          },
          "429": {
            "$ref": "#/components/responses/TooManyRequests"
          }
        },
        "summary": "Execute point-in-time engineering metrics queries",
        "tags": [
          "Eng Intel: 2-Metrics"
        ],
        "x-cortex-mcp-description": "Execute point-in-time queries for one or more engineering metrics.\n\n        Returns current metric values for specified time periods, with support for batch queries\n        and optional period-over-period comparisons. Time range (startTime/endTime) cannot exceed 6 months (180 days).\n\n        PREREQUISITES - Follow this workflow:\n        1. Discover all available metrics ONCE: Call listMetricDefinitions (view='basic') - cache this response\n        2. Get metric query metadata ONCE per metric: Call listMetricDefinitions (view='full', key=METRIC_KEY)\n           - supportedAggregations: Valid aggregation methods\n           - orderByAttribute: Attribute path for sorting by metric values\n           - groupByOptions[].key: Valid groupBy keys (use exact values, do NOT guess)\n           - filterOptions[].key: Valid filter keys (use exact values, do NOT guess)\n           Cache the full view response for each metric. Reuse the metadata from cached responses for subsequent queries on the same metric.\n        3. Construct query: Use the query metadata from the full view responses in step 2 to build valid point-in-time requests\n\n        IMPORTANT: Cache only results from listMetricDefinitions. Do NOT cache point-in-time query results - always execute fresh queries for current data.\n        Only refresh cached listMetricDefinitions responses if no longer in your context window or explicitly requested.\n        Do NOT guess attribute names - always use exact values from listMetricDefinitions responses.\n\n        Response includes:\n        - Lightweight metadata: Column definitions optimized for programmatic use\n        - Row data: Actual metric values and dimensional data\n        - No heavy schemas: Source definitions excluded (get from listMetricDefinitions instead)\n\n        Error responses:\n        - 400: Invalid metric names, date range, validation errors, or unsupported metric combinations\n        - 403: Feature not enabled (contact help@cortex.io)",
        "x-cortex-mcp-enabled": "true",
        "x-internal": true
      }
    }
  ],
  "schemas": {
    "AttributeFilterObject": {
      "required": [
        "attribute",
        "operator",
        "predicate"
      ],
      "type": "object",
      "properties": {
        "attribute": {
          "type": "string"
        },
        "operator": {
          "type": "string",
          "enum": [
            "ANY",
            "BETWEEN",
            "CONTAINS",
            "EQUAL",
            "GREATER_THAN",
            "GREATER_THAN_OR_EQUAL",
            "IN",
            "IS_NOT_NULL",
            "IS_NULL",
            "LESS_THAN",
            "LESS_THAN_OR_EQUAL",
            "LIKE",
            "NOT_EQUAL",
            "NOT_IN",
            "NOT_LIKE"
          ]
        },
        "predicate": {
          "type": "object"
        }
      },
      "description": "Filters to apply to the data"
    },
    "MetricAggregation": {
      "required": [
        "aggregation",
        "metric"
      ],
      "type": "object",
      "properties": {
        "aggregation": {
          "type": "string",
          "enum": [
            "SUM",
            "AVG",
            "COUNT",
            "RATIO",
            "MIN",
            "MAX",
            "P50",
            "P95",
            "RANKING"
          ]
        },
        "metric": {
          "type": "string"
        }
      },
      "description": "Optional nested metrics for advanced queries"
    },
    "TimeWindow": {
      "required": [
        "alias",
        "name",
        "ordinal",
        "windowSize"
      ],
      "type": "object",
      "allOf": [
        {
          "$ref": "#/components/schemas/Column"
        },
        {
          "type": "object",
          "properties": {
            "ordinal": {
              "type": "integer",
              "description": "Zero-based column position in the result data rows - use this to map column metadata to actual row data values",
              "format": "int32"
            },
            "windowSize": {
              "type": "object",
              "properties": {
                "nano": {
                  "type": "integer",
                  "format": "int32"
                },
                "negative": {
                  "type": "boolean"
                },
                "positive": {
                  "type": "boolean"
                },
                "seconds": {
                  "type": "integer",
                  "format": "int64"
                },
                "units": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "dateBased": {
                        "type": "boolean"
                      },
                      "duration": {
                        "type": "object",
                        "properties": {
                          "nano": {
                            "type": "integer",
                            "format": "int32"
                          },
                          "negative": {
                            "type": "boolean"
                          },
                          "positive": {
                            "type": "boolean"
                          },
                          "seconds": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "zero": {
                            "type": "boolean"
                          }
                        }
                      },
                      "durationEstimated": {
                        "type": "boolean"
                      },
                      "timeBased": {
                        "type": "boolean"
                      }
                    }
                  }
                },
                "zero": {
                  "type": "boolean"
                }
              },
              "description": "Duration of the time window represented by this column"
            }
          }
        }
      ]
    },
    "OrderBy": {
      "required": [
        "attribute",
        "direction"
      ],
      "type": "object",
      "properties": {
        "attribute": {
          "type": "string"
        },
        "direction": {
          "type": "string",
          "enum": [
            "ASC",
            "DESC"
          ]
        }
      },
      "description": "Sort order for results"
    },
    "Url": {
      "required": [
        "alias",
        "attributeName",
        "name",
        "ordinal"
      ],
      "type": "object",
      "allOf": [
        {
          "$ref": "#/components/schemas/Column"
        },
        {
          "type": "object",
          "properties": {
            "attributeName": {
              "type": "string",
              "description": "Name of the attribute containing the URL"
            },
            "ordinal": {
              "type": "integer",
              "description": "Zero-based column position in the result data rows - use this to map column metadata to actual row data values",
              "format": "int32"
            }
          }
        }
      ]
    },
    "PointInTimeResponse": {
      "required": [
        "metadata",
        "rows"
      ],
      "type": "object",
      "properties": {
        "metadata": {
          "$ref": "#/components/schemas/QueryMetadata"
        },
        "rows": {
          "type": "array",
          "description": "Result rows containing metric values and dimensions - each row corresponds to the columns in metadata",
          "items": {
            "type": "object",
            "description": "Result rows containing metric values and dimensions - each row corresponds to the columns in metadata"
          }
        }
      }
    },
    "Attribute": {
      "required": [
        "alias",
        "attributeName",
        "name",
        "ordinal"
      ],
      "type": "object",
      "allOf": [
        {
          "$ref": "#/components/schemas/Column"
        },
        {
          "type": "object",
          "properties": {
            "attributeName": {
              "type": "string",
              "description": "Name of the attribute field this column represents"
            },
            "ordinal": {
              "type": "integer",
              "description": "Zero-based column position in the result data rows - use this to map column metadata to actual row data values",
              "format": "int32"
            }
          }
        }
      ]
    },
    "BatchPointInTimeRequest": {
      "required": [
        "endTime",
        "filters",
        "groupBy",
        "limit",
        "metrics",
        "orderBy",
        "startTime"
      ],
      "type": "object",
      "properties": {
        "comparison": {
          "oneOf": [
            {
              "$ref": "#/components/schemas/TimeWindow"
            }
          ]
        },
        "endTime": {
          "type": "string",
          "description": "End time for the query period",
          "format": "date-time"
        },
        "filters": {
          "type": "array",
          "description": "Filters to apply to the data",
          "items": {
            "$ref": "#/components/schemas/AttributeFilterObject"
          }
        },
        "groupBy": {
          "type": "array",
          "description": "Fields to group results by",
          "items": {
            "type": "string",
            "description": "Fields to group results by"
          }
        },
        "limit": {
          "type": "integer",
          "description": "Maximum number of results to return",
          "format": "int32"
        },
        "metrics": {
          "type": "array",
          "description": "List of metrics to query with their aggregation functions",
          "items": {
            "$ref": "#/components/schemas/MetricAggregation"
          }
        },
        "nestedGroupBy": {
          "type": "array",
          "description": "Fields to group nested results by",
          "items": {
            "type": "string",
            "description": "Fields to group nested results by"
          }
        },
        "nestedMetrics": {
          "type": "array",
          "description": "Optional nested metrics for advanced queries",
          "items": {
            "$ref": "#/components/schemas/MetricAggregation"
          }
        },
        "nestedTimeAttribute": {
          "type": "string",
          "description": "Time attribute for nested queries"
        },
        "nextPage": {
          "type": "string",
          "description": "Pagination token for next page of results"
        },
        "orderBy": {
          "type": "array",
          "description": "Sort order for results",
          "items": {
            "$ref": "#/components/schemas/OrderBy"
          }
        },
        "startTime": {
          "type": "string",
          "description": "Start time for the query period",
          "format": "date-time"
        },
        "timeAttribute": {
          "type": "string",
          "description": "Time attribute to use for queries"
        }
      },
      "description": "Point-in-time metrics query request for batch processing"
    },
    "Column": {
      "required": [
        "alias",
        "name",
        "ordinal",
        "type"
      ],
      "type": "object",
      "properties": {
        "alias": {
          "type": "string"
        },
        "category": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "ordinal": {
          "type": "integer",
          "format": "int32"
        },
        "type": {
          "type": "string"
        }
      },
      "description": "List of column definitions describing each field in the result rows",
      "discriminator": {
        "propertyName": "type"
      }
    },
    "EntityReference": {
      "required": [
        "alias",
        "attributeName",
        "entityType",
        "name",
        "ordinal"
      ],
      "type": "object",
      "allOf": [
        {
          "$ref": "#/components/schemas/Column"
        },
        {
          "type": "object",
          "properties": {
            "attributeName": {
              "type": "string",
              "description": "Name of the attribute that references the entity"
            },
            "entityType": {
              "type": "string",
              "description": "Type of entity being referenced (e.g., 'user', 'team', 'service')"
            },
            "ordinal": {
              "type": "integer",
              "description": "Zero-based column position in the result data rows - use this to map column metadata to actual row data values",
              "format": "int32"
            }
          }
        }
      ]
    },
    "MetricValue": {
      "required": [
        "alias",
        "metricKey",
        "name",
        "ordinal"
      ],
      "type": "object",
      "allOf": [
        {
          "$ref": "#/components/schemas/Column"
        },
        {
          "type": "object",
          "properties": {
            "metricKey": {
              "type": "string",
              "description": "Unique identifier of the metric this column represents"
            },
            "ordinal": {
              "type": "integer",
              "description": "Zero-based column position in the result data rows - use this to map column metadata to actual row data values",
              "format": "int32"
            }
          }
        }
      ]
    },
    "QueryMetadata": {
      "required": [
        "columns"
      ],
      "type": "object",
      "properties": {
        "columns": {
          "type": "array",
          "description": "List of column definitions describing each field in the result rows",
          "items": {
            "oneOf": [
              {
                "$ref": "#/components/schemas/Attribute"
              },
              {
                "$ref": "#/components/schemas/EntityReference"
              },
              {
                "$ref": "#/components/schemas/MetricAggregate"
              },
              {
                "$ref": "#/components/schemas/MetricValue"
              },
              {
                "$ref": "#/components/schemas/TimeWindow"
              },
              {
                "$ref": "#/components/schemas/Url"
              }
            ]
          }
        }
      },
      "description": "Query metadata describing the structure of returned columns"
    },
    "MetricAggregate": {
      "required": [
        "aggregationFunction",
        "alias",
        "metricKey",
        "name",
        "ordinal"
      ],
      "type": "object",
      "allOf": [
        {
          "$ref": "#/components/schemas/Column"
        },
        {
          "type": "object",
          "properties": {
            "aggregationFunction": {
              "type": "string",
              "enum": [
                "SUM",
                "AVG",
                "COUNT",
                "RATIO",
                "MIN",
                "MAX",
                "P50",
                "P95",
                "RANKING"
              ]
            },
            "metricKey": {
              "type": "string",
              "description": "Unique identifier of the metric being aggregated"
            },
            "ordinal": {
              "type": "integer",
              "description": "Zero-based column position in the result data rows - use this to map column metadata to actual row data values",
              "format": "int32"
            }
          }
        }
      ]
    }
  },
  "referenced_common_schemas": []
}
